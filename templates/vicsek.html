<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Модель Вичека</title>
  <link rel="stylesheet" href="../static/css/styles.css">
  <!-- Подключаем MathJax для рендеринга LaTeX -->
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      chtml: {
        scale: 0.9
      }
    };
  </script>
</head>
<body>
  <canvas id="canvas"></canvas>

  <div id="controlPanel" class="collapsed">
    <button id="toggleBtn">☰</button>
    <div id="mainControls">
      <!-- Информационная панель -->
      <table class="info-display">
        <tr>
          <th class="id-lables">Итерации $n$</th>
          <th class="id-lables">Параметр порядка $\Phi^n$</th>
          <th class="id-lables">Средний $\langle\Phi\rangle$</th>
        </tr>
        <tr>
          <td class="id-values">
            <span id="iterationCount">0</span>
          </td>
          <td class="id-values">
            <span id="currentPhi">0.0000</span>
          </td>
          <td class="id-values">
            <span id="avgPhi">0.0000</span>
          </td>
        </tr>
      </table>
      
      <!-- Кнопки управления -->
      <div class="control-group">
        <div class="button-group">
          <button id="pauseBtn">Пауза</button>
          <button id="resetBtn">Сброс</button>
          <button id="newSeedBtn">Новый сид</button>
        </div>
        <div class="button-group">
          <button id="showTrailsBtn">След ВЫКЛ</button>
          <button id="showNeighborsBtn">Соседи ВЫКЛ</button>
          <button id="showVelocitiesBtn">Скор ВЫКЛ</button>
        </div>
      </div>

      <!-- Основные параметры -->
      <div class="control-group">
        <div class="control-row">
          <label class="tooltip-label" data-tooltip="particleCount">Число частиц $N$:</label>
          <input type="range" id="particleCount" min="50" max="150" step="10" value="100">
          <span class="value-display" id="particleCountVal">100</span>
        </div>
        <div class="control-row">
          <label class="tooltip-label" data-tooltip="interactionRadius">Радиус взаимодействия $r$:</label>
          <input type="range" id="interactionRadius" min="1" max="50" step="0.5" value="15">
          <span class="value-display" id="interactionRadiusVal">15</span>
        </div>
        <div class="control-row">
          <label class="tooltip-label" data-tooltip="noiseAmplitude">Амплитуда шума $\eta$:</label>
          <input type="range" id="noiseAmplitude" min="0" max="3.14" step="0.05" value="0.5">
          <span class="value-display" id="noiseAmplitudeVal">0.50</span>
        </div>
        <div class="control-row">
          <label class="tooltip-label" data-tooltip="speed">Скорость $v_0$:</label>
          <input type="range" id="speed" min="0.1" max="5" step="0.1" value="2.0">
          <span class="value-display" id="speedVal">2.0</span>
        </div>
      </div>

      <!-- Кнопка расширенных настроек -->
      <div id="advancedCG" class="control-group">
        <button id="advancedBtn">Расширенные настройки</button>
      </div>

      <!-- Расширенные настройки -->
      <div id="advancedControls">
        <div class="control-row">
          <label class="tooltip-label" data-tooltip="timeStep">Шаг времени $\Delta t$:</label>
          <input type="range" id="timeStep" min="0.1" max="2" step="0.1" value="1.0">
          <span class="value-display" id="timeStepVal">1.0</span>
        </div>

        <div class="control-row">
          <label class="tooltip-label" data-tooltip="burnIn">Длина разогрева $B$:</label>
          <input type="range" id="burnIn" min="0" max="1000" step="50" value="200">
          <span class="value-display" id="burnInVal">200</span>
        </div>

        <div class="control-row">
          <label class="tooltip-label" data-tooltip="avgWindow">Окно усреднения $M$:</label>
          <input type="range" id="avgWindow" min="50" max="500" step="25" value="100">
          <span class="value-display" id="avgWindowVal">100</span>
        </div>

        <div class="control-row">
          <label class="tooltip-label" data-tooltip="initHeadings">Начальные направления:</label>
          <button id="initHeadingsBtn">равномерные</button>
        </div>

        <div class="control-row">
          <label class="tooltip-label" data-tooltip="initPositions">Начальные позиции:</label>
          <button id="initPositionsBtn">равномерные</button>
        </div>

        <div class="control-row">
          <label class="tooltip-label" data-tooltip="vizTrails">Длина следов:</label>
          <input type="range" id="vizTrails" min="0" max="200" step="10" value="50">
          <span class="value-display" id="vizTrailsVal">50</span>
        </div>

        <div id="seed_container" class="control-row">
          <label class="tooltip-label" data-tooltip="rngSeed">Seed (ГПСЧ):</label>
          <input type="number" id="rngSeed" min="0" max="999999999" value="42">
        </div>
      </div>
    </div>
  </div>

  <!-- Всплывающие подсказки -->
  <div id="tooltip" class="tooltip"></div>

  <script type="module">
    import { initVicsek } from "../static/js/vicsek.js";

    const canvas = document.getElementById("canvas");
    
    const { createUI } = initVicsek(canvas, {
      particleCount: 100,
      interactionRadius: 15,
      noiseAmplitude: 0.5,
      speed: 2.0,
      timeStep: 1.0,
      initHeadings: 'uniform',
      initPositions: 'uniform',
      burnIn: 200,
      avgWindow: 100,
      vizTrails: 50,
      rngSeed: 42,
      isPreview: false
    });

    // Создаем UI
    createUI();
  </script>
</body>
</html>
